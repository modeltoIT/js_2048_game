var t={};t=class{#t=2;#e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];constructor(t=this.#e){for(let e of(this.initialState=t,this.state=[],this.score=0,this.prevState=[],this.isChanged=!1,this.status="idle",t))this.state.push([...e])}getStatus(){return this.status}setStatus(t){this.status=t}gameEnd(){for(let t=0;t<this.state.length;t++)for(let e=1;e<this.state[0].length;e++)if(this.state[t][e-1]===this.state[t][e]||this.state[e-1][t]===this.state[e][t]||0===this.state[t][e-1]||0===this.state[t][e])return!1;return this.setStatus("lose"),!0}changes(t){this.isChanged=!1;for(let e=0;e<t.length;e++)for(let s=0;s<t[0].length;s++)if(this.state[e][s]!==t[e][s])return this.isChanged=!0,this.addValue(),this.isChanged;return this.isChanged}freeSpaceToLeft(t){for(let e of t)for(let t=0;t<e.length;t++){let t=e.findIndex((t,e,s)=>{if(0===s[e-1]&&0!==t)return!0}),s=e.slice(0,t).indexOf(0);-1!==s&&-1!==t&&(e[s]=e[t],e[t]=0)}return t}updateState(t=this.state){let e=this.copyState(t);return e=this.freeSpaceToLeft(e),e=this.addUp(e),e=this.freeSpaceToLeft(e)}moveLeft(){"playing"===this.getStatus()&&(this.prevState=this.copyState(this.state),this.state=this.updateState(),this.changes(this.prevState),this.gameEnd())}moveRight(t=this.state){if("playing"!==this.getStatus())return;let e=!0;t===this.state&&(e=!1,this.prevState=this.copyState(this.state));let s=[];for(let e of t)s.push([...e].toReversed());for(let t of(s=this.updateState(s),this.state=[],s))this.state.push([...t].toReversed());return e||(this.changes(this.prevState),this.gameEnd()),this.state}transposeMatrix(t=this.state){let e=this.copyState(t);for(let s=0;s<t.length;s++)for(let a=0;a<t[0].length;a++)e[a][s]=t[s][a];return e}moveUp(){this.upOrDown(this.updateState)}moveDown(){this.upOrDown(this.moveRight)}upOrDown(t){if("playing"!==this.getStatus())return;this.prevState=this.copyState(this.state);let e=this.transposeMatrix();e=t.call(this,e),this.state=this.transposeMatrix(e),this.changes(this.prevState),this.gameEnd()}getScore(){return this.score}getState(){return this.state}start(){this.setStatus("playing"),this.validateInitialState();for(let t=0;t<this.#t;t++)this.addValue()}restart(){this.state=this.copyState(),this.setStatus("idle"),this.score=0}copyState(t=this.initialState){let e=[];for(let s of t)e.push([...s]);return e}addValue(){let t=0;for(let e=0;e<1;e++){let s=Math.floor(Math.random()*this.state.length),a=Math.floor(Math.random()*this.state[0].length),i=.9>Math.random()?2:4;if(t++>1e3)break;if(0!==this.state[a][s]){e--;continue}this.state[a][s]=i}}addUp(t){for(let e of t)for(let t=1;t<e.length;t++)e[t-1]===e[t]&&(e[t-1]=e[t-1]+e[t],this.score+=e[t-1],e[t]=0,e[t-1]>=2048&&this.setStatus("win"));return t}validateInitialState(){let t=0;for(let e of this.state){for(let t of e)if(t%2!=0||t>2048||t<0)return this.state=this.copyState(this.#e),!1;t+=e.reduce((t,e)=>t+e)}return 0!==t}};const e=document.querySelector(".button"),s=document.querySelector(".message-start"),a=document.querySelector(".message-win"),i=document.querySelector(".message-lose"),r=document.querySelectorAll(".field-cell"),h=document.querySelector(".game-score");function n(){let t=[];for(let e of o.state)t.push(...e);for(let e=0;e<r.length;e++)r[e].classList.length>1&&r[e].classList.remove(r[e].classList[r[e].classList.length-1]),0!==t[e]?(r[e].textContent=t[e],r[e].classList.add(`field-cell--${t[e]}`)):r[e].textContent="";h.textContent=o.score,"win"===o.getStatus()&&a.classList.remove("hidden"),"lose"===o.getStatus()&&i.classList.remove("hidden")}const o=new t([[123,128,0,8],[16,8,16,32],[8,16,32,64],[16,32,0,128]]);e.addEventListener("click",()=>{e.classList.contains("start")&&o.start(),e.classList.contains("restart")&&(i.classList.contains("hidden")||i.classList.add("hidden"),a.classList.contains("hidden")||a.classList.add("hidden"),o.restart(),o.start()),e.classList.remove("start"),e.textContent="Restart",e.classList.add("restart"),s.classList.add("hidden"),n()}),document.addEventListener("keydown",function(t){a.classList.contains("hidden")&&e.classList.contains("restart")&&("ArrowLeft"===t.key&&o.moveLeft(),"ArrowRight"===t.key&&o.moveRight(),"ArrowUp"===t.key&&o.moveUp(),"ArrowDown"===t.key&&o.moveDown(),("ArrowUp"===t.key||"ArrowDown"===t.key||"ArrowLeft"===t.key||"ArrowRight"===t.key)&&n())});
//# sourceMappingURL=index.c98cbf98.js.map
